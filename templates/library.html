{% extends "base.html" %}

{% block title %}Library{% endblock %}

{% block content %}
<div x-data="libraryData()">
    <h2>Library</h2>
    <p class="subtitle">{{ title_count }} titles found</p>

    <!-- Search and Sort Controls -->
    <div class="uk-grid-small" uk-grid>
        <div class="uk-margin-bottom uk-width-3-4@s">
            <form class="uk-search uk-search-default">
                <span uk-search-icon></span>
                <input class="uk-search-input" type="search" placeholder="Search" x-model="searchQuery">
            </form>
        </div>
        <div class="uk-margin-bottom uk-width-1-4@s">
            <select class="uk-select" @change="handleSortChange($event)">
            <option value="title:1"{% if sort_name_asc %} selected{% endif %}>â–² Name</option>
            <option value="title:0"{% if sort_name_desc %} selected{% endif %}>â–¼ Name</option>
            <option value="modified:1"{% if sort_time_asc %} selected{% endif %}>â–² Date Modified</option>
            <option value="modified:0"{% if sort_time_desc %} selected{% endif %}>â–¼ Date Modified</option>
            <option value="progress:1"{% if sort_progress_asc %} selected{% endif %}>â–² Progress</option>
            <option value="progress:0"{% if sort_progress_desc %} selected{% endif %}>â–¼ Progress</option>
            </select>
        </div>
    </div>

    <!-- Titles Grid -->
    <div class="titles-grid">
        {% for title in titles %}
        <a href="/book/{{ title.id }}" class="title-card"
           x-show="matchesSearch('{{ title.name }}')">
            <div class="title-thumbnail">
                {% match title.first_entry_id %}
                {% when Some with (entry_id) %}
                <img src="/api/cover/{{ title.id }}/{{ entry_id }}" alt="{{ title.name }}" loading="lazy">
                {% when None %}
                <div class="placeholder-icon">ðŸ“–</div>
                {% endmatch %}
                <div class="progress-badge">{{ title.progress }}%</div>
            </div>
            <div class="title-info">
                <div class="title-name uk-card-title">{{ title.name }}</div>
                <div class="title-stats">{{ title.entry_count }} {% if title.entry_count == 1 %}entry{% else %}entries{% endif %}</div>
            </div>
        </a>
        {% endfor %}

        {% if titles.is_empty() %}
        <p>No manga found. Add manga files to your library directory.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/library.js"></script>
{% endblock %}
