<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ entry_name }} - Page {{ current_page }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.5.9/dist/css/uikit.min.css" />
    <style>
    {% include "reader_styles.css" %}
    </style>
</head>
<body class="paged-mode fit-height">
    <div id="reader-container">
        <!-- Settings button -->
        <button id="settings-btn" onclick="UIkit.modal('#settings-modal').show()">⚙️</button>

        <!-- Loading indicator -->
        <div id="loading">Loading...</div>

        <!-- Continuous mode container -->
        <div id="continuous-container">
            <!-- Images will be inserted here by JavaScript -->
        </div>

        <!-- Paged mode container -->
        <div id="paged-container">
            <img id="paged-image" alt="Page {{ current_page }}">
            <div class="click-zone click-zone-left" onclick="handleLeftClick()"></div>
            <div class="click-zone click-zone-right" onclick="handleRightClick()"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="uk-flex-top" uk-modal>
        <div class="uk-modal-dialog uk-margin-auto-vertical">
            <button class="uk-modal-close-default" type="button" uk-close></button>
            <div class="uk-modal-header">
                <h3 class="uk-modal-title break-word">{{ entry_name }}</h3>
                <p class="uk-text-meta uk-margin-remove-bottom break-word">{{ entry_path }}</p>
            </div>
            <div class="uk-modal-body">
                <!-- Progress -->
                <div class="uk-margin">
                    <p id="progress-text">Progress: {{ current_page }}/{{ total_pages }}</p>
                </div>

                <!-- Jump to Page -->
                <div class="uk-margin">
                    <label class="uk-form-label" for="page-select">Jump to Page</label>
                    <div class="uk-form-controls">
                        <select id="page-select" class="uk-select" onchange="jumpToPage()">
                            {% for p in 1..=total_pages %}
                            <option value="{{ p }}"{% if p == current_page %} selected{% endif %}>{{ p }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Reading Mode -->
                <div class="uk-margin">
                    <label class="uk-form-label" for="mode-select">Mode</label>
                    <div class="uk-form-controls">
                        <select id="mode-select" class="uk-select" onchange="changeMode()">
                            <option value="continuous">Continuous</option>
                            <option value="paged" selected>Paged</option>
                        </select>
                    </div>
                </div>

                <!-- Page Fit (paged mode only) -->
                <div class="uk-margin" id="fit-section">
                    <label class="uk-form-label" for="fit-select">Page Fit</label>
                    <div class="uk-form-controls">
                        <select id="fit-select" class="uk-select" onchange="changeFit()">
                            <option value="height" selected>Fit Height</option>
                            <option value="width">Fit Width</option>
                            <option value="real">Real Size</option>
                        </select>
                    </div>
                </div>

                <!-- Page Margin (continuous mode only) -->
                <div class="uk-margin uk-hidden" id="margin-section">
                    <label class="uk-form-label" for="margin-range">Page Margin: <span id="margin-value">20</span>px</label>
                    <div class="uk-form-controls">
                        <input id="margin-range" class="uk-range" type="range" min="0" max="50" step="5" value="20" oninput="changeMargin()">
                    </div>
                </div>

                <!-- Enable Flip Animation (paged mode only) -->
                <div class="uk-margin" id="animation-section">
                    <label class="uk-form-label" for="enable-flip-animation">Enable Flip Animation</label>
                    <div class="uk-form-controls">
                        <input id="enable-flip-animation" class="uk-checkbox" type="checkbox" checked onchange="toggleAnimation()">
                    </div>
                </div>

                <!-- Preload Images (paged mode only) -->
                <div class="uk-margin" id="preload-section">
                    <label class="uk-form-label" for="preload-range">Preload: <span id="preload-value">2</span> page(s)</label>
                    <div class="uk-form-controls">
                        <input id="preload-range" class="uk-range" type="range" min="0" max="5" step="1" value="2" oninput="changePreload()">
                    </div>
                </div>

                <!-- Right to Left (paged mode only) -->
                <div class="uk-margin" id="rtl-section">
                    <label class="uk-form-label" for="enable-rtl">Right to Left</label>
                    <div class="uk-form-controls">
                        <input id="enable-rtl" class="uk-checkbox" type="checkbox" onchange="toggleRTL()">
                    </div>
                </div>

                <hr class="uk-divider-icon">

                <!-- Jump to Entry -->
                <div class="uk-margin">
                    <label class="uk-form-label" for="entry-select">Jump to Entry</label>
                    <div class="uk-form-controls">
                        <select id="entry-select" class="uk-select" onchange="jumpToEntry()">
                            {% for entry in entries %}
                            <option value="{{ entry.id }}"{% if entry.id == entry_id %} selected{% endif %}>{{ entry.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <div class="uk-modal-footer uk-text-right">
                {% if let Some(url) = prev_entry_url %}
                <a class="uk-button uk-button-default uk-margin-small-bottom uk-margin-small-right" href="{{ url }}">Previous Entry</a>
                {% endif %}
                {% if let Some(url) = next_entry_url %}
                <a class="uk-button uk-button-default uk-margin-small-bottom uk-margin-small-right" href="{{ url }}">Next Entry</a>
                {% endif %}
                <a class="uk-button uk-button-danger uk-margin-small-bottom uk-margin-small-right" href="{{ exit_url }}">Exit Reader</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/uikit@3.5.9/dist/js/uikit.min.js"></script>
    <script>
    {% include "reader_scripts.js" %}
    </script>
</body>
</html>
