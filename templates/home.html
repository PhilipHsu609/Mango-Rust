{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div x-data="homePageData()">
    <!-- Continue Reading Section -->
    <template x-if="continueReading.length > 0">
        <div class="uk-margin-large-bottom">
            <h2 class="uk-title">Continue Reading</h2>
            <div class="uk-child-width-1-4@m uk-child-width-1-2" uk-grid>
                <template x-for="item in continueReading" :key="item.entry_id">
                    <div class="item">
                        <div class="uk-card uk-card-default uk-card-hover is_entry"
                             @click="showModal(item.title_id, item.title_name, item.entry_id, item.entry_name, item.pages, item.percentage, item.progress)">
                            <div class="uk-card-media-top">
                                <img :src="`/api/cover/${item.title_id}/${item.entry_id}`" :alt="item.entry_name">
                            </div>
                            <div class="uk-card-body">
                                <div class="uk-card-badge label" x-show="item.percentage" x-text="`${parseFloat(item.percentage).toFixed(1)}%`"></div>
                                <h3 class="uk-card-title break-word uk-margin-remove-bottom" x-text="item.entry_name"></h3>
                                <a class="uk-card-title break-word uk-margin-remove-top uk-text-meta uk-display-inline-block"
                                   :href="`/book/${item.title_id}`"
                                   @click.stop
                                   x-text="item.title_name"></a>
                                <p class="uk-text-meta" x-text="`${item.pages} pages`"></p>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </template>

    <!-- Start Reading Section -->
    <template x-if="startReading.length > 0">
        <div class="uk-margin-large-bottom">
            <h2 class="uk-title">Start Reading</h2>
            <div class="uk-child-width-1-4@m uk-child-width-1-2" uk-grid>
                <template x-for="item in startReading" :key="item.id">
                    <div class="item">
                        <a :href="`/book/${item.id}`" class="uk-link-reset">
                            <div class="uk-card uk-card-default uk-card-hover">
                                <div class="uk-card-media-top">
                                    <img :src="item.first_entry_id ? `/api/cover/${item.id}/${item.first_entry_id}` : '/static/placeholder.png'" :alt="item.title">
                                </div>
                                <div class="uk-card-body">
                                    <div class="uk-card-badge label" x-text="`${parseFloat(item.progress || 0).toFixed(1)}%`"></div>
                                    <h3 class="uk-card-title break-word" x-text="item.title"></h3>
                                    <p class="uk-text-meta" x-text="`${item.entry_count} ${item.entry_count === 1 ? 'entry' : 'entries'}`"></p>
                                </div>
                            </div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </template>

    <!-- Recently Added Section -->
    <template x-if="recentlyAdded.length > 0">
        <div class="uk-margin-large-bottom">
            <h2 class="uk-title">Recently Added</h2>
            <div class="uk-child-width-1-4@m uk-child-width-1-2" uk-grid>
                <template x-for="item in recentlyAdded" :key="item.entry_id">
                    <div class="item">
                        <!-- Title card for grouped items -->
                        <template x-if="item.grouped_count > 1">
                            <a :href="`/book/${item.title_id}`" class="uk-link-reset">
                                <div class="uk-card uk-card-default uk-card-hover">
                                    <div class="uk-card-media-top">
                                        <img :src="`/api/cover/${item.title_id}/${item.entry_id}`" :alt="item.title_name">
                                    </div>
                                    <div class="uk-card-body">
                                        <h3 class="uk-card-title break-word" x-text="item.title_name"></h3>
                                        <p class="uk-text-meta" x-text="`${item.grouped_count} new entries`"></p>
                                    </div>
                                </div>
                            </a>
                        </template>

                        <!-- Entry card for single items -->
                        <template x-if="item.grouped_count === 1">
                            <div class="uk-card uk-card-default uk-card-hover is_entry"
                                 @click="showModal(item.title_id, item.title_name, item.entry_id, item.entry_name, item.pages, item.percentage, Math.round(item.pages * parseFloat(item.percentage) / 100))">
                                <div class="uk-card-media-top">
                                    <img :src="`/api/cover/${item.title_id}/${item.entry_id}`" :alt="item.entry_name">
                                </div>
                                <div class="uk-card-body">
                                    <div class="uk-card-badge label" x-show="item.percentage" x-text="`${parseFloat(item.percentage).toFixed(1)}%`"></div>
                                    <h3 class="uk-card-title break-word uk-margin-remove-bottom" x-text="item.entry_name"></h3>
                                    <a class="uk-card-title break-word uk-margin-remove-top uk-text-meta uk-display-inline-block"
                                       :href="`/book/${item.title_id}`"
                                       @click.stop
                                       x-text="item.title_name"></a>
                                    <p class="uk-text-meta" x-text="`${item.pages} pages`"></p>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </template>

    <!-- Empty State - No content yet -->
    <template x-if="continueReading.length === 0 && startReading.length === 0 && recentlyAdded.length === 0">
        <div class="uk-container uk-text-center uk-margin-large-top">
            <i class="fas fa-book-open" style="font-size: 80px; color: #999;"></i>
            <h2>Read your first manga</h2>
            <p class="uk-text-muted">Once you start reading, Mango will remember where you left off and show your entries here.</p>
            <a href="/library" class="uk-button uk-button-default">View library</a>
        </div>
    </template>

    <!-- Entry Modal (UIKit) -->
    <div id="entry-modal" class="uk-flex-top" uk-modal>
        <div class="uk-modal-dialog uk-margin-auto-vertical">
            <button class="uk-modal-close-default" type="button" uk-close></button>
            <div class="uk-modal-header">
                <h3 class="uk-modal-title break-word" id="modal-title"></h3>
            </div>
            <div class="uk-modal-body">
                <p class="uk-text-meta" id="modal-pages"></p>

                <div class="uk-margin">
                    <label class="uk-form-label">Read</label>
                    <p class="uk-margin-small-top">
                        <a id="modal-beginning-btn" class="uk-button uk-button-default">From beginning</a>
                        <a id="modal-continue-btn" class="uk-button uk-button-primary"></a>
                    </p>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label">Progress</label>
                    <p class="uk-margin-small-top">
                        <button id="modal-read-btn" class="uk-button uk-button-default" @click="markAsRead()">Mark as read (100%)</button>
                        <button id="modal-unread-btn" class="uk-button uk-button-default" @click="markAsUnread()">Mark as unread (0%)</button>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/home.js"></script>
{% endblock %}
