{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/static/css/home.css">
{% endblock %}

{% block content %}
<div x-data="homePageData()">
    <!-- Continue Reading Section -->
    <div class="section">
        <h2>Continue Reading</h2>
        <div class="cards-grid" x-show="continueReading.length > 0">
            <template x-for="item in continueReading" :key="item.entry_id">
                <div class="card entry-card"
                     @click="showModal(item.title_id, item.title_name, item.entry_id, item.entry_name, item.pages, item.percentage, item.progress)">
                    <div class="card-thumbnail">
                        <img :src="`/api/cover/${item.title_id}/${item.entry_id}`" :alt="item.entry_name">
                        <span class="progress-badge" x-show="item.percentage" x-text="`${item.percentage}%`"></span>
                    </div>
                    <div class="card-info">
                        <div class="card-title" x-text="item.entry_name"></div>
                        <div class="card-subtitle">
                            <a :href="`/book/${item.title_id}`"
                               class="book-link"
                               @click.stop
                               x-text="item.title_name"></a>
                        </div>
                        <div class="card-stats" x-text="`${item.pages} pages`"></div>
                    </div>
                </div>
            </template>
        </div>
        <div class="empty-state" x-show="continueReading.length === 0">
            <div class="empty-state-icon">ðŸ“š</div>
            <p>No manga in progress yet. Start reading from the Library!</p>
        </div>
    </div>

    <!-- Start Reading Section -->
    <div class="section">
        <h2>Start Reading</h2>
        <div class="cards-grid" x-show="startReading.length > 0">
            <template x-for="item in startReading" :key="item.id">
                <a :href="`/book/${item.id}`" class="card">
                    <div class="card-thumbnail">
                        <img :src="item.first_entry_id ? `/api/cover/${item.id}/${item.first_entry_id}` : '/static/placeholder.png'" :alt="item.title">
                    </div>
                    <div class="card-info">
                        <div class="card-title" x-text="item.title"></div>
                        <div class="card-subtitle" x-text="`${item.entry_count} ${item.entry_count === 1 ? 'entry' : 'entries'}`"></div>
                    </div>
                </a>
            </template>
        </div>
        <div class="empty-state" x-show="startReading.length === 0">
            <div class="empty-state-icon">âœ¨</div>
            <p>All caught up! Check the Library for new titles.</p>
        </div>
    </div>

    <!-- Recently Added Section -->
    <div class="section">
        <h2>Recently Added</h2>
        <div class="cards-grid" x-show="recentlyAdded.length > 0">
            <template x-for="item in recentlyAdded" :key="item.entry_id">
                <!-- Title card for grouped items -->
                <a x-show="item.grouped_count > 1"
                   :href="`/book/${item.title_id}`"
                   class="card">
                    <div class="card-thumbnail">
                        <img :src="`/api/cover/${item.title_id}/${item.entry_id}`" :alt="item.title_name">
                    </div>
                    <div class="card-info">
                        <div class="card-title" x-text="item.title_name"></div>
                        <div class="card-subtitle" x-text="`${item.grouped_count} new entries`"></div>
                    </div>
                </a>

                <!-- Entry card for single items -->
                <div x-show="item.grouped_count === 1"
                     class="card entry-card"
                     @click="showModal(item.title_id, item.title_name, item.entry_id, item.entry_name, item.pages, item.percentage, Math.round(item.pages * parseFloat(item.percentage) / 100))">
                    <div class="card-thumbnail">
                        <img :src="`/api/cover/${item.title_id}/${item.entry_id}`" :alt="item.entry_name">
                        <span class="progress-badge" x-show="item.percentage" x-text="`${item.percentage}%`"></span>
                    </div>
                    <div class="card-info">
                        <div class="card-title" x-text="item.entry_name"></div>
                        <div class="card-subtitle">
                            <a :href="`/book/${item.title_id}`"
                               class="book-link"
                               @click.stop
                               x-text="item.title_name"></a>
                        </div>
                        <div class="card-stats" x-text="`${item.pages} pages`"></div>
                    </div>
                </div>
            </template>
        </div>
        <div class="empty-state" x-show="recentlyAdded.length === 0">
            <div class="empty-state-icon">ðŸ†•</div>
            <p>No recently added titles.</p>
        </div>
    </div>

    <!-- Entry Modal (UIKit) -->
    <div id="entry-modal" uk-modal>
        <div class="uk-modal-dialog uk-modal-body">
            <button class="uk-modal-close-default" type="button" uk-close></button>
            <h2 class="uk-modal-title" id="modal-title"></h2>
            <p class="uk-text-meta" id="modal-pages"></p>

            <p class="uk-text-bold">Read</p>
            <p class="uk-margin">
                <a id="modal-beginning-btn" class="uk-button uk-button-default">From beginning</a>
                <a id="modal-continue-btn" class="uk-button uk-button-primary"></a>
            </p>

            <p class="uk-text-bold">Progress</p>
            <p class="uk-margin">
                <button id="modal-read-btn" class="uk-button uk-button-default" @click="markAsRead()">Mark as read (100%)</button>
                <button id="modal-unread-btn" class="uk-button uk-button-default" @click="markAsUnread()">Mark as unread (0%)</button>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/home.js"></script>
{% endblock %}
