{
  "id": "snapshot_1763797750265_0kgdj64az",
  "approvalId": "approval_1763797708248_2w7qxam3b",
  "approvalTitle": "Design: Theme Naming Refactor (Revised)",
  "version": 3,
  "timestamp": "2025-11-22T07:49:10.265Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\nThis design implements a semantically correct, dual-class theme system for Mango-Rust with **consistent variable naming** and **centralized style management**. The refactoring converts the confusing backwards naming (`uk-light` for dark mode) to intuitive, modern conventions (`uk-dark` for dark mode, `uk-light` for light mode).\n\n### Key Improvements (Based on User Feedback)\n\n**1. Consistent Variable Naming** ✨\n- **Problem**: Light variables lacked consistent prefix (`@text-primary`, `@bg-white` - ambiguous)\n- **Solution**: All light variables now use `@light-` prefix (mirrors `@dark-` prefix)\n- **Result**: `@light-text-primary` vs `@dark-text-primary` - instantly clear\n\n**2. Centralized Style Management** ✨\n- **Problem**: Light theme scattered across multiple files (`base.less`, `_uikit-light.less`, implicit defaults)\n- **Solution**: Single source of truth for each theme:\n  - `_variables.less`: ALL color tokens (light + dark)\n  - `_light-theme.less`: ALL light styles (one file)\n  - `_dark-theme.less`: ALL dark styles (one file)\n- **Result**: Easy to find, modify, and maintain theme-specific styles\n\n**3. Symmetric Implementation** ✨\n- Both themes treated equally (no more \"dark is special, light is default\")\n- Both themes use explicit class selectors (`body.uk-light` and `body.uk-dark`)\n- Both themes use prefixed variables (`@light-*` and `@dark-*`)\n\nThe solution involves renaming CSS selectors, restructuring LESS files, standardizing variable names, and updating JavaScript theme management logic while maintaining backwards compatibility with existing user preferences.\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\n**N/A** - No steering documents exist for this project. Design follows established patterns found in codebase:\n- LESS-based CSS architecture with modular imports\n- Vanilla JavaScript for DOM manipulation (no framework dependencies)\n- localStorage for client-side persistence\n- UIkit CSS framework as foundation\n\n### Project Structure (structure.md)\n\n**Current Frontend Structure (following existing patterns):**\n```\nstatic/src/\n├── css/\n│   ├── _variables.less        # Design tokens (colors, spacing, typography)\n│   ├── _dark-theme.less        # Dark mode overrides (currently uses body.uk-light)\n│   ├── _uikit-light.less       # Light mode UIkit overrides\n│   ├── base.less               # Global layout and typography\n│   ├── main.less               # Entry point (import order)\n│   ├── components/             # Reusable UI components\n│   └── pages/                  # Page-specific styles\n└── js/\n    └── core.js                 # Theme management + localStorage helpers\n```\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **`_variables.less`**: Already defines both light and dark color tokens\n  - Light tokens: `@bg-light`, `@text-primary`, `@primary-color`, etc. (inconsistent naming)\n  - Dark tokens: `@dark-bg`, `@dark-text-primary`, `@dark-border`, etc. (consistent `@dark-` prefix)\n  - **Issue**: Light variables lack consistent `@light-` prefix\n  - **Reuse Strategy**: Refactor to add `@light-` prefix for consistency\n\n- **`core.js` theme functions**: Existing API structure is sound\n  - `getTheme()`: Returns 'dark' or 'light'\n  - `applyTheme(theme)`: Applies theme class to body\n  - `toggleTheme()`: Switches between themes\n  - `detectSystemTheme()`: Respects prefers-color-scheme\n  - **Reuse Strategy**: Keep function signatures, update class names in implementation\n\n- **LESS build system**: Build pipeline already compiles LESS to CSS\n  - Build script: `./build-css.sh` (uses `lessc`)\n  - Entry point: `static/src/css/main.less`\n  - Output: `static/css/main.css`\n  - **Reuse Strategy**: No changes to build process, only source files\n\n### Integration Points\n\n- **Templates**: No changes required\n  - Templates already include compiled `main.css` and `core.js`\n  - Theme logic is entirely CSS class-based\n  - No server-side theme rendering\n\n- **localStorage**: Maintains existing schema\n  - Key: `'theme'`\n  - Values: `'dark'` or `'light'` (no change)\n  - Backwards compatible with existing user preferences\n\n## Architecture\n\nThe refactoring uses a **dual-class explicit theme system** with **centralized variable management** where both light and dark modes are explicitly defined using CSS class selectors and consistent variable naming. This replaces the current asymmetric approach (dark = class, light = baseline).\n\n### Key Improvements\n\n1. **Consistent Variable Naming**: All theme-specific variables use prefixes\n   - Light theme: `@light-bg`, `@light-text-primary`, `@light-border`, etc.\n   - Dark theme: `@dark-bg`, `@dark-text-primary`, `@dark-border`, etc.\n   - Theme-agnostic: `@primary-color`, `@accent-gold`, `@spacing-*`, etc. (no prefix)\n\n2. **Centralized Theme Management**:\n   - Single file `_variables.less`: ALL color tokens (light and dark)\n   - Single file `_light-theme.less`: ALL light theme styles using `@light-*` variables\n   - Single file `_dark-theme.less`: ALL dark theme styles using `@dark-*` variables\n   - Base styles (`base.less`, components, pages): Use NO theme-specific colors, only structural styles\n\n3. **Symmetric Theme Implementation**:\n   - Both themes have equal file structure and naming conventions\n   - Both themes are opt-in via class (`body.uk-light` or `body.uk-dark`)\n   - No implicit defaults, all theming explicit\n\n### Modular Design Principles\n\n- **Single File Responsibility**:\n  - `_light-theme.less`: ONLY light mode overrides (scope: `body.uk-light`)\n  - `_dark-theme.less`: ONLY dark mode overrides (scope: `body.uk-dark`)\n  - `_variables.less`: Theme-agnostic design tokens\n  - `core.js`: Theme state management (no business logic mixing)\n\n- **Component Isolation**:\n  - Theme files operate independently through CSS cascade\n  - No cross-dependencies between theme files\n  - Variables provide shared contract (DRY principle)\n\n- **Service Layer Separation**:\n  - JavaScript: Theme detection → selection → application (pure functions)\n  - CSS: Theme definition → scoped overrides (declarative)\n  - localStorage: Persistence layer (separated from logic)\n\n```mermaid\ngraph TD\n    A[User Action / System Preference] --> B[core.js: Theme Detection]\n    B --> C{getTheme / detectSystemTheme}\n    C --> D[applyTheme function]\n    D --> E{Theme Value}\n    E -->|'dark'| F[Add body.uk-dark class]\n    E -->|'light'| G[Add body.uk-light class]\n    F --> H[CSS: _dark-theme.less applies]\n    G --> I[CSS: _light-theme.less applies]\n    H --> J[User sees dark UI]\n    I --> K[User sees light UI]\n    D --> L[localStorage.setItem theme, value]\n\n    style F fill:#2a2a2a,color:#e5e5e5\n    style H fill:#2a2a2a,color:#e5e5e5\n    style J fill:#2a2a2a,color:#e5e5e5\n    style G fill:#fafafa,color:#333\n    style I fill:#fafafa,color:#333\n    style K fill:#fafafa,color:#333\n```\n\n### CSS Cascade Strategy\n\n**Import Order in `main.less`** (determines cascade priority):\n```less\n1. _variables.less       // Design tokens (no selectors)\n2. base.less             // Baseline/default styles\n3. _light-theme.less     // Light mode overrides (body.uk-light scope)\n4. components/_nav.less  // Component styles\n5. pages/*.less          // Page-specific styles\n6. _dark-theme.less      // Dark mode overrides (body.uk-dark scope) - LAST\n```\n\n**Rationale**:\n- Base styles provide fallback if neither theme class present\n- Light theme comes before dark theme in source order\n- Dark theme loads last, ensuring overrides work correctly\n- Component/page styles can be themed by both light and dark selectors\n\n## Components and Interfaces\n\n### Component 0: Centralized Design Tokens (LESS Variables)\n\n**File**: `static/src/css/_variables.less`\n\n**Purpose**: Single source of truth for ALL design tokens (colors, spacing, typography) with consistent naming\n\n**Current Problems**:\n```less\n// INCONSISTENT - Light variables lack prefix\n@bg-light: #fafafa;              // Has \"light\" in name\n@bg-white: white;                // No prefix\n@bg-elevated: white;             // No prefix\n@text-primary: #333;             // No prefix (ambiguous!)\n@text-secondary: #666;           // No prefix (ambiguous!)\n@border-light: #e5e5e5;          // Has \"light\" in name\n\n// CONSISTENT - Dark variables have prefix\n@dark-bg: rgb(20, 20, 20);       // Prefixed ✓\n@dark-text-primary: #e5e5e5;     // Prefixed ✓\n@dark-border: #3a3a3a;           // Prefixed ✓\n```\n\n**Refactored Structure** (consistent prefixing):\n```less\n// ============================================================================\n// LESS Variables - Design Tokens\n// Single source of truth - ALL themes defined here\n// ============================================================================\n\n// ----------------------------------------------------------------------------\n// Theme-Agnostic Tokens (no prefix - shared across themes)\n// ----------------------------------------------------------------------------\n@primary-color: #1e87f0;         // UIKit blue (same in both themes)\n@accent-gold: #c5a06d;           // Gold accent (same in both themes)\n@border-radius: 5px;\n@font-family: -apple-system, BlinkMacSystemFont, ...;\n@spacing-sm: 20px;\n// ... typography, spacing, breakpoints, z-index, transitions\n\n// ----------------------------------------------------------------------------\n// Light Theme Tokens (all prefixed with @light-)\n// ----------------------------------------------------------------------------\n\n// Backgrounds\n@light-bg: #fafafa;              // RENAMED from @bg-light\n@light-bg-white: white;          // RENAMED from @bg-white\n@light-bg-elevated: white;       // RENAMED from @bg-elevated\n@light-bg-card: #f8f8f8;         // RENAMED from @bg-card\n\n// Text Colors\n@light-text-primary: #333;       // RENAMED from @text-primary\n@light-text-secondary: #666;     // RENAMED from @text-secondary\n@light-text-tertiary: #999;      // RENAMED from @text-tertiary\n@light-text-muted: #999;         // RENAMED from @text-muted\n\n// UI Colors\n@light-border: #e5e5e5;          // RENAMED from @border-light\n@light-shadow: 0 1px 3px rgba(0,0,0,.05); // RENAMED from @shadow-light\n\n// ----------------------------------------------------------------------------\n// Dark Theme Tokens (already prefixed with @dark-)\n// ----------------------------------------------------------------------------\n\n// Backgrounds\n@dark-bg: rgb(20, 20, 20);       // NO CHANGE\n@dark-bg-elevated: #2a2a2a;      // NO CHANGE\n@dark-bg-input: #1a1a1a;         // NO CHANGE\n@dark-bg-hover: #333;            // NO CHANGE\n\n// Text Colors\n@dark-text-primary: #e5e5e5;     // NO CHANGE\n@dark-text-secondary: #aaa;      // NO CHANGE\n@dark-text-muted: #666;          // NO CHANGE\n\n// UI Colors\n@dark-border: #3a3a3a;           // NO CHANGE\n@dark-border-light: #4a4a4a;     // NO CHANGE\n```\n\n**Benefits of Consistent Naming**:\n1. **Clarity**: `@light-text-primary` vs `@dark-text-primary` - instantly obvious\n2. **Searchability**: Easy to find all light variables with `grep '@light-'`\n3. **Maintainability**: Adding new theme variables follows clear pattern\n4. **Symmetry**: Light and dark treated equally, no implicit assumptions\n\n**Migration Impact**:\n- All existing references to unprefixed variables must be updated\n- Example: `color: @text-primary;` → `color: @light-text-primary;` (in light theme file)\n- Dark theme file already uses prefixed variables (no changes needed)\n\n**Dependencies**: None (this is the foundation)\n\n**Reuses**: Existing variable values (only names change)\n\n---\n\n### Component 1: Theme State Manager (JavaScript)\n\n**File**: `static/src/js/core.js`\n\n**Purpose**: Detect, apply, and persist theme preferences\n\n**Interfaces**:\n```javascript\n// Public API (exposed globally)\ngetTheme(): string                    // Returns 'dark' | 'light'\napplyTheme(theme: string): void       // Applies theme class, saves to localStorage\ntoggleTheme(): void                   // Switches between themes\ndetectSystemTheme(): string           // Returns 'dark' | 'light' from system\n\n// Internal helpers\nfunction ensureSingleThemeClass()     // Removes opposite theme class before applying new\n```\n\n**Dependencies**:\n- Browser APIs: `localStorage`, `window.matchMedia`, `document.body.classList`\n- No external libraries\n\n**Reuses**: Existing function structure, localStorage key `'theme'`\n\n**Changes**:\n```javascript\n// OLD (current):\nif (theme === 'dark') {\n    document.body.classList.add('uk-light');\n} else {\n    document.body.classList.remove('uk-light');\n}\n\n// NEW (refactored):\n// Remove opposite theme class first\ndocument.body.classList.remove('uk-dark', 'uk-light');\n// Add correct theme class\nif (theme === 'dark') {\n    document.body.classList.add('uk-dark');\n} else {\n    document.body.classList.add('uk-light');\n}\n```\n\n### Component 2: Light Theme Styles (CSS/LESS)\n\n**File**: `static/src/css/_light-theme.less`\n\n**Purpose**: Define light mode appearance for all UI components\n\n**Interfaces**:\n- CSS selector scope: `body.uk-light { ... }`\n- Inherits from: `_variables.less` (light color tokens)\n\n**Dependencies**:\n- `@import '_variables'` (for `@bg-light`, `@text-primary`, etc.)\n\n**Reuses**: Content from current `_uikit-light.less` + baseline styles\n\n**Structure**:\n```less\nbody.uk-light {\n    color: @text-primary;\n    background: @bg-light;\n\n    // Navigation\n    .uk-navbar-container { background: @bg-white; }\n\n    // Forms\n    .uk-input { background: white; color: @text-primary; }\n\n    // Cards, modals, buttons, etc.\n    // ... (comprehensive light theme overrides)\n}\n```\n\n### Component 3: Dark Theme Styles (CSS/LESS)\n\n**File**: `static/src/css/_dark-theme.less`\n\n**Purpose**: Define dark mode appearance for all UI components\n\n**Interfaces**:\n- CSS selector scope: `body.uk-dark { ... }` (CHANGED from `body.uk-light`)\n- Inherits from: `_variables.less` (dark color tokens)\n\n**Dependencies**:\n- `@import '_variables'` (for `@dark-bg`, `@dark-text-primary`, etc.)\n\n**Reuses**: Existing file content (358 lines), only selector changes\n\n**Changes**: Single find-replace operation\n```less\n// OLD:\nbody.uk-light { ... }\n\n// NEW:\nbody.uk-dark { ... }\n```\n\n### Component 4: LESS Entry Point (Build Configuration)\n\n**File**: `static/src/css/main.less`\n\n**Purpose**: Import all LESS sources in correct cascade order\n\n**Interfaces**:\n- Build tool input (consumed by `lessc`)\n- Outputs: `static/css/main.css`\n\n**Dependencies**: All LESS partials\n\n**Changes**:\n```less\n// OLD:\n@import '_uikit-light';     // Line 13\n@import '_dark-theme';      // Line 25\n\n// NEW:\n@import '_light-theme';     // Line 13 (renamed file)\n@import '_dark-theme';      // Line 25 (no change)\n```\n\n## Data Models\n\n### Theme Preference Model (localStorage)\n\n**Schema**: Simple string value\n\n```typescript\n// localStorage key-value pair\n{\n  key: 'theme',\n  value: 'dark' | 'light' | null\n}\n\n// Runtime JavaScript representation\ninterface ThemeState {\n  saved: 'dark' | 'light' | null;     // From localStorage\n  system: 'dark' | 'light';            // From matchMedia\n  effective: 'dark' | 'light';         // Computed (saved ?? system)\n  class: 'uk-dark' | 'uk-light';       // Applied to body\n}\n```\n\n**Validation**:\n```javascript\nfunction isValidTheme(value) {\n    return value === 'dark' || value === 'light';\n}\n```\n\n### CSS Class State Model\n\n**Mutually Exclusive Classes**: Only ONE of these can be active at a time\n```\nbody.uk-dark     // Dark theme active\nbody.uk-light    // Light theme active\nbody             // Neither (fallback to base styles)\n```\n\n**State Transitions**:\n```\n[Load] → Check localStorage → Apply saved OR system preference\n[Toggle] → Remove current → Add opposite → Save to localStorage\n[System Change] → If no manual override → Apply system preference\n```\n\n## Error Handling\n\n### Error Scenarios\n\n1. **Scenario: localStorage unavailable (private browsing, quota exceeded)**\n   - **Handling**: Graceful degradation to system theme detection\n   - **Code**:\n     ```javascript\n     function saveTheme(theme) {\n         try {\n             localStorage.setItem('theme', theme);\n         } catch (e) {\n             console.warn('Theme preference not saved:', e.message);\n             // Continue with in-memory theme (still works for session)\n         }\n     }\n     ```\n   - **User Impact**: Theme preference lost on page reload (defaults to system)\n\n2. **Scenario: matchMedia API not supported (old browsers)**\n   - **Handling**: Default to light theme\n   - **Code**:\n     ```javascript\n     function detectSystemTheme() {\n         if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n             return 'dark';\n         }\n         return 'light';  // Safe default\n     }\n     ```\n   - **User Impact**: System preference ignored, defaults to light\n\n3. **Scenario: Invalid theme value in localStorage (corruption/tampering)**\n   - **Handling**: Validate and fallback to system detection\n   - **Code**:\n     ```javascript\n     function getTheme() {\n         const saved = localStorage.getItem('theme');\n         if (saved === 'dark' || saved === 'light') {\n             return saved;  // Valid\n         }\n         return detectSystemTheme();  // Invalid, use system\n     }\n     ```\n   - **User Impact**: Corrupted preference ignored, auto-detects theme\n\n4. **Scenario: FOUC (Flash of Unstyled Content) during page load**\n   - **Handling**: Apply theme class to `<html>` element before DOM ready\n   - **Code**:\n     ```javascript\n     // IIFE runs immediately (before DOMContentLoaded)\n     (function() {\n         const theme = getTheme();\n         const className = theme === 'dark' ? 'uk-dark' : 'uk-light';\n         document.documentElement.classList.add(className);\n     })();\n     ```\n   - **User Impact**: No flash, correct theme renders immediately\n\n## Testing Strategy\n\n### Unit Testing\n\n**JavaScript Functions** (can be tested in isolation):\n```javascript\n// Test suite structure (if testing framework added later)\ndescribe('Theme Management', () => {\n    test('detectSystemTheme returns dark when prefers-color-scheme is dark')\n    test('detectSystemTheme returns light when prefers-color-scheme is light')\n    test('getTheme returns localStorage value when valid')\n    test('getTheme returns detectSystemTheme when localStorage invalid')\n    test('applyTheme adds uk-dark class when theme is dark')\n    test('applyTheme adds uk-light class when theme is light')\n    test('applyTheme removes opposite class before applying new')\n    test('toggleTheme switches from dark to light')\n    test('toggleTheme switches from light to dark')\n});\n```\n\n**Manual Testing Checklist** (current approach):\n- [ ] Browser console: `getTheme()` returns correct value\n- [ ] Browser console: `applyTheme('dark')` adds `uk-dark` class\n- [ ] Browser console: `applyTheme('light')` adds `uk-light` class\n- [ ] Browser console: `toggleTheme()` switches classes correctly\n\n### Integration Testing\n\n**Theme Application Flow**:\n```javascript\n// Test scenarios (manual browser testing)\n1. Fresh user (no localStorage):\n   - Open in private/incognito window\n   - Verify system theme detected\n   - Verify correct class applied to body\n   - Verify localStorage set after detection\n\n2. Returning user (existing preference):\n   - Set localStorage.setItem('theme', 'dark')\n   - Reload page\n   - Verify dark theme loads (ignores system preference)\n\n3. Theme toggle:\n   - Click theme toggle button\n   - Verify class switches on body\n   - Verify localStorage updates\n   - Verify UI re-renders correctly\n\n4. System theme change:\n   - Clear localStorage\n   - Change OS theme (System Settings)\n   - Verify app follows system change\n```\n\n**CSS Theme Rendering**:\n```\nTest Matrix: Verify visual appearance for each theme\n\nComponents to test:\n- Navigation bar (background, text colors, hover states)\n- Cards (title-card, entry-card on library/book pages)\n- Forms (inputs, selects, checkboxes)\n- Modals (background, borders, text)\n- Buttons (default, primary variants)\n- Tables (headers, rows, hover states)\n- Alerts (warning, success backgrounds)\n\nFor each component:\n✓ Light theme: Matches light design tokens\n✓ Dark theme: Matches dark design tokens\n✓ No theme class: Has readable fallback\n```\n\n### End-to-End Testing\n\n**User Scenarios** (manual browser testing):\n\n1. **First-time visitor with dark system preference**:\n   - User has macOS/Windows dark mode enabled\n   - Opens Mango-Rust in browser\n   - Expected: Dark theme loads immediately, no flash\n   - Expected: `body` has `uk-dark` class\n   - Expected: localStorage has `theme: \"dark\"`\n\n2. **User manually switches to light theme**:\n   - User clicks theme toggle button/icon\n   - Expected: UI transitions to light theme smoothly\n   - Expected: `body` class changes from `uk-dark` to `uk-light`\n   - Expected: localStorage updates to `theme: \"light\"`\n   - User refreshes page\n   - Expected: Light theme persists (ignores dark system preference)\n\n3. **User clears browser data**:\n   - User clears localStorage via DevTools or browser settings\n   - User refreshes page\n   - Expected: System theme auto-detected again\n   - Expected: Correct theme class applied\n\n4. **Cross-page navigation**:\n   - User selects dark theme on home page\n   - User navigates to library page\n   - Expected: Dark theme persists across navigation\n   - User navigates to book page\n   - Expected: Dark theme still active\n   - User navigates to reader page\n   - Expected: Dark theme still active (reader may have custom styling)\n\n**Browser Compatibility Testing**:\n```\nTest in:\n- Chrome/Edge (Chromium) - Latest\n- Firefox - Latest\n- Safari - Latest (macOS/iOS)\n\nVerify:\n- Theme classes apply correctly\n- localStorage works\n- matchMedia API works (system theme detection)\n- CSS renders correctly (vendor prefixes not needed for modern features)\n```\n\n## Migration Strategy\n\nThis migration has been reorganized to address user feedback on **consistent variable naming** and **centralized style management**.\n\n### Phase 1: Refactor Variables for Consistency\n**Goal**: Add `@light-` prefix to all light theme variables in `_variables.less`\n\n**Actions**:\n1. Update `_variables.less`:\n   - Rename all unprefixed light variables to use `@light-` prefix\n   - Examples:\n     - `@text-primary` → `@light-text-primary`\n     - `@bg-white` → `@light-bg-white`\n     - `@bg-elevated` → `@light-bg-elevated`\n     - `@border-light` → `@light-border`\n   - Keep dark variables unchanged (already have `@dark-` prefix)\n   - Keep theme-agnostic variables unchanged (`@primary-color`, `@spacing-*`, etc.)\n\n2. Update all references to renamed variables:\n   - Search for old variable names in all `.less` files\n   - Replace with new `@light-` prefixed names\n   - Files to update: `base.less`, `_uikit-light.less`, component files, page files\n\n**Verification**: Run `lessc` build, should compile without errors\n\n---\n\n### Phase 2: Centralize Light Theme Styles\n**Goal**: Create comprehensive light theme file with all overrides in one place\n\n**Actions**:\n1. Create new file `_light-theme.less`:\n   - Wrap all rules in `body.uk-light { ... }` scope\n   - Migrate styles from `_uikit-light.less`\n   - Add comprehensive light overrides (mirror structure of `_dark-theme.less`)\n   - Use only `@light-*` variables for colors\n\n2. Clean up other files:\n   - Remove theme-specific colors from `base.less` (structural styles only)\n   - Remove theme-specific colors from component/page files\n   - All color theming should be in `_light-theme.less` or `_dark-theme.less`\n\n3. Delete `_uikit-light.less` (content migrated to `_light-theme.less`)\n\n**Verification**: Build CSS and visually test light theme\n\n---\n\n### Phase 3: Centralize Dark Theme Styles\n**Goal**: Update dark theme to use semantic `body.uk-dark` selector\n\n**Actions**:\n1. Update `_dark-theme.less`:\n   - Find-replace: `body.uk-light {` → `body.uk-dark {`\n   - No other changes needed (already uses `@dark-*` variables)\n\n**Verification**: CSS selector changed, but no visual changes yet (JS still uses old class)\n\n---\n\n### Phase 4: Update JavaScript Theme Logic\n**Goal**: Map theme values to correct CSS classes\n\n**Actions**:\n1. Update `core.js`:\n   - Change class application logic:\n     ```javascript\n     // OLD:\n     if (theme === 'dark') {\n         document.body.classList.add('uk-light');\n     } else {\n         document.body.classList.remove('uk-light');\n     }\n\n     // NEW:\n     document.body.classList.remove('uk-dark', 'uk-light');\n     if (theme === 'dark') {\n         document.body.classList.add('uk-dark');\n     } else {\n         document.body.classList.add('uk-light');\n     }\n     ```\n\n   - Update FOUC prevention (IIFE at top):\n     ```javascript\n     // OLD:\n     if (theme === 'dark') {\n         document.documentElement.classList.add('uk-light');\n     }\n\n     // NEW:\n     const className = theme === 'dark' ? 'uk-dark' : 'uk-light';\n     document.documentElement.classList.add(className);\n     ```\n\n**Verification**: Test theme toggle in browser, verify classes change correctly\n\n---\n\n### Phase 5: Update Build Configuration\n**Goal**: Import new `_light-theme.less` file\n\n**Actions**:\n1. Update `main.less`:\n   - Change line 13: `@import '_uikit-light';` → `@import '_light-theme';`\n   - Verify import order:\n     ```less\n     @import '_variables';      // 1. Design tokens\n     @import 'base';            // 2. Baseline\n     @import '_light-theme';    // 3. Light theme\n     @import 'components/_nav'; // 4. Components\n     @import 'pages/*';         // 5. Pages\n     @import '_dark-theme';     // 6. Dark theme (LAST)\n     ```\n\n**Verification**: Run `./build-css.sh`, no errors\n\n---\n\n### Phase 6: Comprehensive Testing\n**Goal**: Verify all themes work correctly with no regressions\n\n**Actions**:\n1. Build final CSS: `./build-css.sh`\n2. Manual testing per testing strategy (see Testing Strategy section)\n3. Visual regression testing:\n   - Compare light theme before/after (should be identical)\n   - Compare dark theme before/after (should be identical)\n4. Test theme persistence across page reloads\n5. Test system theme detection\n6. Test theme toggle functionality\n\n**Verification**: All visual tests pass, no regressions\n\n---\n\n### Rollback Plan\nIf issues discovered post-deployment:\n1. Revert `core.js` changes (restore old class names)\n2. Rebuild CSS\n3. Deploy reverted version\n4. Investigate issues in development environment\n\n## Backwards Compatibility\n\n**localStorage Migration**: None needed!\n- Existing localStorage schema unchanged\n- Values remain `'dark'` and `'light'` (strings)\n- JavaScript reads same values, just maps to different CSS classes\n\n**User Experience**: Seamless\n- Users with `theme: 'dark'` in localStorage → Still get dark theme\n- Users with `theme: 'light'` in localStorage → Still get light theme\n- Users with no preference → Still get system theme\n\n**No Breaking Changes**:\n- Templates not modified (no server-side changes)\n- HTML structure unchanged (no new elements)\n- localStorage API unchanged\n- Theme toggle behavior unchanged (user-facing)\n",
  "fileStats": {
    "size": 26989,
    "lines": 777,
    "lastModified": "2025-11-22T07:48:19.682Z"
  },
  "comments": []
}