{
  "id": "snapshot_1763798067736_njcaac4d7",
  "approvalId": "approval_1763797984839_y8k0ua0oj",
  "approvalTitle": "Tasks: Theme Naming Refactor",
  "version": 2,
  "timestamp": "2025-11-22T07:54:27.736Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document\n\n## Phase 1: Variable Naming Consistency\n\n- [ ] 1.1. Refactor light theme variables in _variables.less\n  - File: static/src/css/_variables.less\n  - Rename all unprefixed light variables to use `@light-` prefix for consistency with dark variables\n  - Examples: `@text-primary` → `@light-text-primary`, `@bg-white` → `@light-bg-white`, `@bg-elevated` → `@light-bg-elevated`, `@border-light` → `@light-border`\n  - Keep dark variables unchanged (already have `@dark-` prefix), keep theme-agnostic variables unchanged (`@primary-color`, `@spacing-*`, etc.)\n  - Purpose: Create symmetric, consistent naming convention where `@light-*` mirrors `@dark-*`\n  - _Leverage: Existing variable structure in static/src/css/_variables.less_\n  - _Requirements: Requirements 1, 2 (consistent variable naming for both themes)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Developer specializing in design systems and variable management | Task: Refactor light theme variables in static/src/css/_variables.less to use consistent `@light-` prefix following Requirements 1 and 2. Rename unprefixed light variables (`@text-primary`, `@bg-white`, `@bg-elevated`, `@border-light`) to prefixed versions (`@light-text-primary`, `@light-bg-white`, `@light-bg-elevated`, `@light-border`). Keep dark variables (`@dark-*`) and theme-agnostic variables (`@primary-color`, `@spacing-*`) unchanged. | Restrictions: Do not change dark variable names, do not change theme-agnostic variable names, do not change variable values (only names), maintain all existing comments and organization | Leverage: Existing variable structure in static/src/css/_variables.less | Success: All light theme variables use `@light-` prefix, dark variables unchanged, theme-agnostic variables unchanged, file compiles without LESS syntax errors, variable organization maintained | Instructions: Before starting, mark this task as in-progress in tasks.md by changing [ ] to [-]. After completing the refactoring and verifying the build compiles, use the log-implementation tool to record detailed implementation information with artifacts (variables renamed, file modified, statistics). Then mark this task as complete in tasks.md by changing [-] to [x]._\n\n- [ ] 1.2. Update variable references in base.less\n  - Files: static/src/css/base.less\n  - Find and replace all references to old unprefixed light variables with new `@light-` prefixed names\n  - Example: `color: @text-primary;` → `color: @light-text-primary;`\n  - Purpose: Update base stylesheet to use new consistent variable names\n  - _Leverage: Grep/search tools to find all variable references_\n  - _Requirements: Requirements 1, 2 (consistent variable usage)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Developer with expertise in stylesheet refactoring | Task: Update all variable references in static/src/css/base.less to use new `@light-` prefixed variable names following Requirements 1 and 2. Search for old variable names (`@text-primary`, `@bg-white`, `@bg-elevated`, `@border-light`, etc.) and replace with new prefixed names (`@light-text-primary`, `@light-bg-white`, `@light-bg-elevated`, `@light-border`, etc.). | Restrictions: Only update light theme variables that were renamed in task 1.1, do not change dark variables or theme-agnostic variables, maintain all CSS selectors and structure unchanged | Leverage: Use grep/search to find all variable references: `grep -n '@text-primary\\|@bg-white\\|@bg-elevated\\|@border-light' static/src/css/base.less` | Success: All references to renamed variables updated, file compiles without LESS errors, no broken variable references, visual output unchanged | Instructions: Before starting, mark this task as in-progress in tasks.md. After updating all references and verifying build compiles, use log-implementation tool with artifacts (files modified, number of replacements, lines changed). Mark complete in tasks.md._\n\n- [ ] 1.3. Update variable references in _uikit-light.less\n  - Files: static/src/css/_uikit-light.less\n  - Find and replace all references to old unprefixed light variables with new `@light-` prefixed names\n  - Purpose: Update UIkit light mode overrides to use new consistent variable names\n  - _Leverage: Grep/search tools to find all variable references_\n  - _Requirements: Requirements 1, 2 (consistent variable usage)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Developer with expertise in stylesheet refactoring | Task: Update all variable references in static/src/css/_uikit-light.less to use new `@light-` prefixed variable names following Requirements 1 and 2. Search and replace old variable names with new prefixed versions. | Restrictions: Only update variables that were renamed in task 1.1, maintain all CSS selectors and structure, do not change file organization | Leverage: Use grep to find references: `grep -n '@text-primary\\|@bg-white\\|@bg-elevated\\|@border-light' static/src/css/_uikit-light.less` | Success: All renamed variable references updated, file compiles without errors, visual output unchanged | Instructions: Mark task in-progress in tasks.md before starting. After updating references and verifying compilation, log implementation with artifacts. Mark complete in tasks.md._\n\n- [ ] 1.4. Update variable references in component and page files\n  - Files: static/src/css/components/_nav.less, static/src/css/pages/_library.less, static/src/css/pages/_book.less, static/src/css/pages/_home.less, static/src/css/pages/_reader.less\n  - Find and replace all references to old unprefixed light variables with new `@light-` prefixed names across all component and page files\n  - Purpose: Update all remaining LESS files to use consistent variable names\n  - _Leverage: Grep/search tools to find variable references across multiple files_\n  - _Requirements: Requirements 1, 2 (consistent variable usage)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Developer with expertise in large-scale refactoring | Task: Update all variable references in component and page LESS files (components/_nav.less, pages/_library.less, pages/_book.less, pages/_home.less, pages/_reader.less) to use new `@light-` prefixed variable names following Requirements 1 and 2. Systematically search and replace across all files. | Restrictions: Only update variables renamed in task 1.1, preserve all CSS structure and selectors, maintain file-specific styling logic | Leverage: Use recursive grep: `grep -rn '@text-primary\\|@bg-white\\|@bg-elevated\\|@border-light' static/src/css/components/ static/src/css/pages/` | Success: All references updated across all files, all files compile without errors, visual output unchanged, no broken references | Instructions: Mark in-progress. After updating all files and verifying build success, log with detailed artifacts (files modified, replacements per file, total changes). Mark complete._\n\n- [ ] 1.5. Build CSS and verify variable refactoring\n  - Files: Run ./build-css.sh\n  - Build the CSS with all variable name changes and verify no compilation errors\n  - Visual test: Load application, verify light theme looks identical to before refactoring\n  - Purpose: Validate that variable naming refactoring is complete and correct\n  - _Leverage: Build script ./build-css.sh, browser for visual testing_\n  - _Requirements: Requirements 1, 2 (verification of consistent naming)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in CSS testing and visual regression | Task: Build CSS using ./build-css.sh and perform comprehensive verification that variable refactoring is correct following Requirements 1 and 2. Check for LESS compilation errors, verify all variable references resolve correctly, visual test light theme to ensure appearance unchanged. | Restrictions: Do not proceed to next phase if build fails or visual differences detected, do not modify code in this task (only verify), must test in actual browser | Leverage: Build script ./build-css.sh, browser DevTools for visual inspection | Success: CSS builds without errors, no undefined variable errors, light theme visual appearance identical to pre-refactoring, no console errors | Instructions: Mark in-progress. Run build, check output for errors. Load app in browser, verify light theme appearance. Take screenshots if needed. Log verification results with statistics (build time, output size, visual test results). Mark complete only if all checks pass._\n\n## Phase 2: Centralize Light Theme Styles\n\n- [ ] 2.1. Create comprehensive _light-theme.less file\n  - Files: static/src/css/_light-theme.less (new file)\n  - Create new light theme file with `body.uk-light { ... }` scope containing all light theme styles\n  - Migrate content from _uikit-light.less, expand to match structure of _dark-theme.less (navigation, modals, buttons, forms, cards, tables, page-specific styles)\n  - Use only `@light-*` prefixed variables for all colors\n  - Purpose: Centralize all light theme styles in single file with explicit class scope\n  - _Leverage: Structure from static/src/css/_dark-theme.less as template, content from static/src/css/_uikit-light.less_\n  - _Requirements: Requirement 2 (semantic light theme with uk-light class)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Architect with expertise in theme systems and stylesheet organization | Task: Create comprehensive static/src/css/_light-theme.less file with all light theme styles scoped to `body.uk-light` selector following Requirement 2. Mirror the structure of _dark-theme.less (navigation, modals, buttons, forms, cards, tables, lists, links, badges, alerts, page-specific styles). Migrate existing content from _uikit-light.less and expand to cover all UI components. Use only `@light-*` variables for colors. | Restrictions: Must wrap all rules in `body.uk-light { ... }` scope, only use `@light-*` prefixed variables for colors, do not duplicate structural styles from base.less, maintain comprehensive coverage matching _dark-theme.less | Leverage: Use _dark-theme.less (357 lines) as structural template, migrate content from _uikit-light.less, reference `@light-*` variables from _variables.less | Success: New file created with comprehensive light theme, all styles scoped to body.uk-light, uses only @light-* variables, mirrors dark theme structure, file compiles successfully | Instructions: Mark in-progress. Create file, structure sections (navigation, modals, forms, etc.), write comprehensive styles. Log implementation with detailed artifacts (file created, sections added, variables used, line count, components styled). Mark complete._\n\n- [ ] 2.2. Remove theme-specific colors from base.less\n  - Files: static/src/css/base.less (modify)\n  - Remove all color-related properties from base.less (colors, backgrounds, borders)\n  - Keep only structural styles (layout, typography structure, spacing, box model)\n  - Purpose: Ensure base.less contains no theme-specific styling, all colors come from theme files\n  - _Leverage: Read base.less to identify theme-specific properties_\n  - _Requirements: Requirements 1, 2 (centralized theme management)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Developer with expertise in stylesheet organization and separation of concerns | Task: Clean up static/src/css/base.less to remove all theme-specific color properties following Requirements 1 and 2. Remove color, background-color, border-color, and similar properties. Keep only structural styles (display, position, margin, padding, font-size, font-family, line-height, etc.). All theming should come from _light-theme.less or _dark-theme.less. | Restrictions: Do not remove structural styles (layout, typography structure, spacing), do not remove theme-agnostic variables like @spacing-*, maintain file organization and comments, ensure elements remain accessible without theme classes | Leverage: Review base.less to identify color properties, reference design document for centralization goals | Success: All theme-specific colors removed from base.less, structural styles preserved, file compiles successfully, elements have fallback styling without theme classes | Instructions: Mark in-progress. Review base.less, identify and remove color properties, test compilation. Log with artifacts (properties removed, lines changed, remaining structure). Mark complete._\n\n- [ ] 2.3. Remove theme colors from component files\n  - Files: static/src/css/components/_nav.less (modify if needed)\n  - Review component files and remove any theme-specific color properties\n  - Ensure all theming is handled by _light-theme.less and _dark-theme.less\n  - Purpose: Centralize all theme styling, components provide structure only\n  - _Leverage: Grep to search for color properties in component files_\n  - _Requirements: Requirements 1, 2 (centralized theme management)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Developer with expertise in component architecture and theme systems | Task: Clean up component files (components/_nav.less and any others) to remove theme-specific colors following Requirements 1 and 2. Search for color, background-color, border-color properties and remove them. All theming should come from theme files, components should provide structural styles only. | Restrictions: Only remove theme-specific colors, keep structural and layout styles, do not break component functionality, ensure components work with both themes | Leverage: Use grep to find color properties: `grep -rn 'color:\\|background:\\|border-color:' static/src/css/components/` | Success: Theme-specific colors removed from all component files, structural styles preserved, components work with both light and dark themes, files compile successfully | Instructions: Mark in-progress. Search for color properties, remove theme-specific ones, verify compilation. Log with artifacts (files modified, properties removed). Mark complete._\n\n- [ ] 2.4. Remove theme colors from page files\n  - Files: static/src/css/pages/_library.less, static/src/css/pages/_book.less, static/src/css/pages/_home.less, static/src/css/pages/_reader.less (modify if needed)\n  - Review page files and remove any theme-specific color properties\n  - Ensure page-specific themes are in _light-theme.less and _dark-theme.less instead\n  - Purpose: Complete centralization of theme management\n  - _Leverage: Grep to search for color properties in page files_\n  - _Requirements: Requirements 1, 2 (centralized theme management)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Developer with expertise in page styling and theme systems | Task: Clean up page files (pages/_library.less, pages/_book.less, pages/_home.less, pages/_reader.less) to remove theme-specific colors following Requirements 1 and 2. Remove color, background-color, border-color properties. Page-specific theming should be in theme files (see sections \"Library, Book, Home Pages\" and \"Reader page\" in _dark-theme.less for reference). | Restrictions: Only remove theme-specific colors, preserve page-specific layout and structure, maintain page functionality, ensure pages work with both themes | Leverage: Use grep: `grep -rn 'color:\\|background:\\|border-color:' static/src/css/pages/` | Success: Theme colors removed from all page files, page-specific theming moved to theme files if needed, structural styles preserved, all pages work with both themes | Instructions: Mark in-progress. Search and clean page files, move any page-specific theming to theme files if necessary. Log with artifacts (files modified, colors removed, theming relocated). Mark complete._\n\n- [ ] 2.5. Delete _uikit-light.less file\n  - Files: static/src/css/_uikit-light.less (delete)\n  - Delete the old _uikit-light.less file as its content has been migrated to _light-theme.less\n  - Purpose: Clean up obsolete files after migration\n  - _Leverage: N/A_\n  - _Requirements: Requirement 2 (use _light-theme.less instead)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Developer with expertise in codebase cleanup and file management | Task: Delete obsolete static/src/css/_uikit-light.less file following Requirement 2, as its content has been fully migrated to _light-theme.less in task 2.1. Verify migration is complete before deletion. | Restrictions: Only delete after verifying task 2.1 is complete, ensure no remaining references to this file in import statements, do not delete if migration incomplete | Leverage: Check git status to verify file can be safely deleted | Success: File deleted successfully, no broken imports, codebase builds successfully without the file | Instructions: Mark in-progress. Verify task 2.1 complete, check for remaining references, delete file. Log with artifacts (file deleted, verification performed). Mark complete._\n\n- [ ] 2.6. Build CSS and verify light theme centralization\n  - Files: Run ./build-css.sh\n  - Build CSS and visually verify light theme still works correctly\n  - Test that all UI components render with proper light theme styling\n  - Purpose: Validate centralized light theme implementation\n  - _Leverage: Build script, browser for testing_\n  - _Requirements: Requirement 2 (verify semantic light theme)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in visual testing and theme validation | Task: Build CSS and perform comprehensive visual verification of centralized light theme following Requirement 2. Run ./build-css.sh, test all UI components (navigation, forms, cards, modals, buttons, tables) render correctly with light theme. Verify _light-theme.less provides complete styling. | Restrictions: Do not modify code in this task (verification only), must test in actual browser with light theme active, test all major UI components, check for missing styles or visual regressions | Leverage: Build script ./build-css.sh, browser with theme set to 'light', compare against pre-refactoring screenshots if available | Success: CSS builds without errors, light theme renders correctly on all tested pages, all components properly styled, no missing colors or broken styling, visual appearance matches pre-refactoring | Instructions: Mark in-progress. Build CSS, load app with light theme, systematically test each page and component. Document tested components. Log verification with artifacts (components tested, build statistics, visual test results). Mark complete only if all visual tests pass._\n\n## Phase 3: Centralize Dark Theme Styles\n\n- [ ] 3.1. Update _dark-theme.less to use body.uk-dark selector\n  - Files: static/src/css/_dark-theme.less (modify)\n  - Find and replace `body.uk-light {` with `body.uk-dark {` throughout the file\n  - No other changes needed (file already uses `@dark-*` variables and has comprehensive styling)\n  - Purpose: Update dark theme to use semantically correct CSS class selector\n  - _Leverage: Existing _dark-theme.less structure and content_\n  - _Requirements: Requirement 1 (semantic dark theme with uk-dark class)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Developer with expertise in stylesheet refactoring | Task: Update static/src/css/_dark-theme.less to use semantically correct `body.uk-dark` selector instead of backwards `body.uk-light` following Requirement 1. Perform find-replace: `body.uk-light {` → `body.uk-dark {`. Verify this is the only change needed (file already uses @dark-* variables). | Restrictions: ONLY change the selector from uk-light to uk-dark, do not change any variable names or styling rules, do not modify @dark-* variable usage, maintain all comments and structure | Leverage: Existing _dark-theme.less at 357 lines with comprehensive dark styling | Success: Selector changed from body.uk-light to body.uk-dark, no other changes made, file compiles successfully, dark theme styling unchanged | Instructions: Mark in-progress. Open file, find-replace selector, verify no other changes needed, compile to check syntax. Log with artifacts (selector changed, file modified, line count unchanged ~357 lines). Mark complete._\n\n- [ ] 3.2. Build CSS and verify dark theme selector change\n  - Files: Run ./build-css.sh\n  - Build CSS with new dark theme selector\n  - Note: Dark theme won't visually work yet because JavaScript still uses old class name\n  - Purpose: Verify CSS changes compile correctly before JavaScript update\n  - _Leverage: Build script_\n  - _Requirements: Requirement 1 (verify uk-dark selector compiles)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Developer with expertise in build systems and verification | Task: Build CSS to verify dark theme selector change compiles correctly following Requirement 1. Run ./build-css.sh and check for compilation errors. Dark theme won't visually work yet (expected) because JavaScript still applies old class name - this will be fixed in Phase 4. | Restrictions: Do not modify JavaScript yet, only verify CSS compilation, expect dark theme to not render (this is normal at this stage), only check for LESS compilation errors | Leverage: Build script ./build-css.sh, LESS compiler output | Success: CSS builds without LESS compilation errors, output file generated successfully, body.uk-dark selector present in compiled CSS | Instructions: Mark in-progress. Run build script, check for errors, verify output file contains uk-dark selector. Log with artifacts (build result, output file size, selector verified in compiled CSS). Mark complete if build succeeds._\n\n## Phase 4: Update JavaScript Theme Logic\n\n- [ ] 4.1. Update core.js theme class application logic\n  - Files: static/src/js/core.js (modify)\n  - Update `applyTheme()` function to apply correct classes: 'dark' → 'uk-dark', 'light' → 'uk-light'\n  - Implement mutual exclusion: Remove both classes before applying new one\n  - Update FOUC prevention code (IIFE) to apply correct class before DOM ready\n  - Purpose: Map theme values to semantically correct CSS classes\n  - _Leverage: Existing theme management functions in core.js_\n  - _Requirements: Requirements 1, 2, 3 (apply correct classes, mutual exclusion, no FOUC)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: JavaScript Developer with expertise in DOM manipulation and theme management | Task: Update theme class application logic in static/src/js/core.js following Requirements 1, 2, and 3. Modify applyTheme() to map 'dark'→'uk-dark' and 'light'→'uk-light'. Add mutual exclusion by removing both classes before applying new one. Update FOUC prevention IIFE to use new class names. Change: `if (theme === 'dark') document.body.classList.add('uk-light')` to `document.body.classList.remove('uk-dark', 'uk-light'); if (theme === 'dark') document.body.classList.add('uk-dark'); else document.body.classList.add('uk-light');`. Also update FOUC code similarly. | Restrictions: Maintain localStorage schema unchanged (still stores 'dark'/'light' strings), do not change getTheme() or detectSystemTheme() functions (already correct), preserve all other functionality, ensure backward compatibility with existing preferences | Leverage: Existing core.js functions (getTheme, detectSystemTheme, toggleTheme), DOM classList API | Success: applyTheme() uses correct classes uk-dark/uk-light, mutual exclusion implemented (only one class active), FOUC prevention updated, localStorage compatibility maintained, function signatures unchanged | Instructions: Mark in-progress. Read core.js, update applyTheme() and FOUC prevention, test class application in browser console. Log with detailed artifacts (functions modified, class logic changes, FOUC prevention updated). Mark complete._\n\n- [ ] 4.2. Test JavaScript theme switching functionality\n  - Files: static/src/js/core.js (testing)\n  - Test theme functions in browser: getTheme(), applyTheme(), toggleTheme()\n  - Verify correct classes applied to body element for both themes\n  - Test localStorage persistence and system theme detection\n  - Purpose: Validate JavaScript changes work correctly\n  - _Leverage: Browser DevTools console for testing_\n  - _Requirements: Requirements 1, 2, 3, 4 (verify all theme switching requirements)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in JavaScript testing and browser DevTools | Task: Comprehensively test theme switching functionality in static/src/js/core.js following Requirements 1-4. Open browser DevTools console, test: getTheme() returns correct value, applyTheme('dark') adds uk-dark class, applyTheme('light') adds uk-light class, toggleTheme() switches classes correctly, only one class active at a time, localStorage saves theme correctly, page reload preserves theme, system theme detection works. | Restrictions: Do not modify code (testing only), must test in actual browser, test all theme functions, verify mutual exclusion (inspect body element classes), check localStorage values | Leverage: Browser DevTools console for testing functions, Elements tab to inspect body classes, Application tab to check localStorage | Success: getTheme() works, applyTheme() applies correct classes, toggleTheme() switches properly, mutual exclusion verified, localStorage persistence works, system detection works, page reload preserves theme, no JavaScript errors | Instructions: Mark in-progress. Load app in browser, test all functions systematically, document test results. Log with artifacts (functions tested, test results for each function, localStorage verification, mutual exclusion verified). Mark complete only if all tests pass._\n\n## Phase 5: Update Build Configuration\n\n- [ ] 5.1. Update main.less import statement\n  - Files: static/src/css/main.less (modify)\n  - Change line 13: `@import '_uikit-light';` → `@import '_light-theme';`\n  - Verify import order is correct (variables, base, light-theme, components, pages, dark-theme)\n  - Purpose: Import new light theme file and ensure correct CSS cascade order\n  - _Leverage: Existing main.less import structure_\n  - _Requirements: Requirements 1, 2 (import centralized theme files)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CSS/LESS Developer with expertise in build configuration and cascade order | Task: Update static/src/css/main.less to import new _light-theme.less file following Requirements 1 and 2. Change line 13 from `@import '_uikit-light';` to `@import '_light-theme';`. Verify import order: (1) _variables, (2) base, (3) _light-theme, (4) components/_nav, (5) pages/*, (6) _dark-theme. Dark theme must be last to override light theme. | Restrictions: ONLY change the import statement on line 13, do not reorder other imports unless incorrect, ensure _dark-theme remains last import, maintain all other imports unchanged | Leverage: Existing main.less structure (26 lines) | Success: Import statement updated from _uikit-light to _light-theme, import order correct (dark theme last), file compiles without errors, no broken imports | Instructions: Mark in-progress. Open main.less, update import, verify order, check syntax. Log with artifacts (import changed, import order verified, line modified). Mark complete._\n\n- [ ] 5.2. Build CSS with final configuration\n  - Files: Run ./build-css.sh\n  - Build CSS with all changes: variable naming, centralized themes, new selectors, updated imports\n  - Verify build succeeds with no errors or warnings\n  - Purpose: Generate final CSS with all refactoring complete\n  - _Leverage: Build script ./build-css.sh_\n  - _Requirements: All requirements (final build verification)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Build Engineer with expertise in CSS compilation and verification | Task: Perform final CSS build with all refactoring changes following all requirements. Run ./build-css.sh and verify successful compilation. Check for: no LESS errors, no undefined variables, no missing imports, clean compilation output. This is the final build before comprehensive testing. | Restrictions: Do not modify source files, only build and verify, check build output carefully for any warnings or errors, verify output file generated | Leverage: Build script ./build-css.sh, LESS compiler output messages | Success: Build completes successfully with no errors, no LESS warnings, output file static/css/main.css generated, file size reasonable (~similar to pre-refactoring), no undefined variable errors | Instructions: Mark in-progress. Run build script, carefully review output for errors/warnings, check output file exists and size is reasonable. Log with artifacts (build status, output file size, compilation time, any warnings). Mark complete only if build 100% successful._\n\n## Phase 6: Comprehensive Testing\n\n- [ ] 6.1. Visual regression testing - Light theme\n  - Files: Manual testing in browser\n  - Test light theme across all pages: home, library, book, reader\n  - Verify all UI components styled correctly: navigation, forms, cards, modals, buttons, tables, alerts\n  - Compare against pre-refactoring appearance (should be identical)\n  - Purpose: Ensure light theme visual appearance unchanged after refactoring\n  - _Leverage: Browser with theme set to 'light', screenshots for comparison_\n  - _Requirements: All requirements (verify light theme implementation)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in visual regression testing and UI verification | Task: Perform comprehensive visual regression testing of light theme following all requirements. Set theme to 'light' (localStorage.setItem('theme', 'light'), reload), test all pages systematically: home page (cards, layout), library page (title cards, search, sort), book page (entry cards, modals), reader page (reading interface). For each page, verify all components: navigation bar, buttons, forms/inputs, cards, modals, tables, links, badges, alerts. Compare appearance to pre-refactoring screenshots/memory. | Restrictions: Must test in actual browser not screenshots, systematically test every major UI component, verify body has uk-light class, check for missing colors or broken styles, compare to pre-refactoring state | Leverage: Browser DevTools to inspect elements, Application tab to set localStorage theme, compare to design document expectations | Success: All pages render correctly with light theme, all components properly styled, colors match light theme variables, no visual regressions, appearance identical to pre-refactoring, body.uk-light class present and working | Instructions: Mark in-progress. Load app, set light theme, systematically test each page and component, document findings. Log with detailed artifacts (pages tested, components verified, visual regression results, any issues found). Mark complete only if zero visual regressions._\n\n- [ ] 6.2. Visual regression testing - Dark theme\n  - Files: Manual testing in browser\n  - Test dark theme across all pages: home, library, book, reader\n  - Verify all UI components styled correctly with dark theme colors\n  - Compare against pre-refactoring dark theme (should be identical)\n  - Purpose: Ensure dark theme visual appearance unchanged after refactoring\n  - _Leverage: Browser with theme set to 'dark', screenshots for comparison_\n  - _Requirements: All requirements (verify dark theme implementation)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in visual regression testing and dark mode verification | Task: Perform comprehensive visual regression testing of dark theme following all requirements. Set theme to 'dark' (localStorage.setItem('theme', 'dark'), reload), test all pages: home, library, book, reader. For each page, verify all components render with proper dark theme styling (dark backgrounds, light text): navigation, buttons, forms, cards, modals, tables, links, badges, alerts. Compare to pre-refactoring dark theme. | Restrictions: Must test in actual browser, verify body has uk-dark class (not old uk-light), systematically test every major component, check dark colors applied correctly, compare to pre-refactoring | Leverage: Browser DevTools to inspect body.uk-dark class, Application tab for localStorage, verify dark theme variables applied | Success: All pages render correctly with dark theme, all components use dark colors, colors match dark theme variables, no visual regressions, appearance identical to pre-refactoring (but now uses uk-dark class), body.uk-dark class present | Instructions: Mark in-progress. Set dark theme, test all pages/components, inspect body class is uk-dark. Log with detailed artifacts (pages tested, uk-dark class verified, visual results, comparisons). Mark complete only if zero regressions._\n\n- [ ] 6.3. Test theme switching and persistence\n  - Files: Manual testing in browser\n  - Test theme toggle functionality: click toggle button/icon, verify class switches\n  - Test localStorage persistence: reload page, verify theme persists\n  - Test system theme detection: clear localStorage, verify system theme applied\n  - Test theme changes during session: switch multiple times, verify smooth transitions\n  - Purpose: Verify theme switching UX works correctly with new class names\n  - _Leverage: Browser DevTools console and Application tab_\n  - _Requirements: Requirements 3, 4 (clean switching, backwards compatibility)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in user experience testing and state management | Task: Comprehensively test theme switching and persistence following Requirements 3 and 4. Test: (1) Click theme toggle - verify class switches from uk-light to uk-dark or vice versa, (2) Reload page - verify theme persists via localStorage, (3) Clear localStorage - verify system theme auto-detected, (4) Switch themes multiple times - verify smooth transitions, no FOUC, (5) Check mutual exclusion - inspect body, only one theme class present, (6) Backwards compatibility - existing localStorage values still work. | Restrictions: Test in actual browser, must verify class changes in Elements tab, check localStorage values in Application tab, test FOUC by hard reload, verify system preference detection if possible | Leverage: Browser DevTools Elements tab (inspect body classes), Application tab (localStorage), console (call toggleTheme()), Network tab (check FOUC) | Success: Toggle switches classes correctly (uk-light ↔ uk-dark), localStorage saves and restores theme, system theme detected when no preference, no FOUC on page load, mutual exclusion works (only one class), existing preferences preserved, smooth transitions | Instructions: Mark in-progress. Systematically test each scenario, document results, verify mutual exclusion. Log with detailed artifacts (toggle tested, persistence verified, localStorage checked, FOUC prevention verified, mutual exclusion confirmed). Mark complete only if all switching tests pass._\n\n- [ ] 6.4. Cross-page navigation testing\n  - Files: Manual testing in browser\n  - Set theme to dark, navigate through all pages (home → library → book → reader), verify dark theme persists\n  - Set theme to light, navigate through all pages, verify light theme persists\n  - Purpose: Ensure theme remains consistent across page navigation\n  - _Leverage: Browser navigation, DevTools to inspect theme class_\n  - _Requirements: Requirement 4 (backwards compatibility and persistence)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in end-to-end user flow testing | Task: Test theme persistence across page navigation following Requirement 4. Scenario 1: Set dark theme, navigate home→library→book→reader, verify uk-dark class present on every page. Scenario 2: Set light theme, navigate through all pages, verify uk-light class throughout. Check localStorage remains consistent, no theme flickering during navigation. | Restrictions: Test actual page navigation (click links), do not use browser back/forward yet (separate test), inspect body class on each page, verify localStorage not changing during navigation | Leverage: Browser navigation between pages, DevTools Elements tab to inspect body class on each page, Application tab to verify localStorage | Success: Dark theme persists across all pages, light theme persists across all pages, body class remains consistent (uk-dark or uk-light), localStorage unchanged during navigation, no theme flickering or FOUC during page transitions | Instructions: Mark in-progress. Set dark theme, navigate through pages, verify class. Repeat for light theme. Check for any inconsistencies. Log with artifacts (navigation flows tested, class consistency verified, localStorage stability confirmed). Mark complete if theme persists correctly._\n\n- [ ] 6.5. Browser compatibility testing\n  - Files: Manual testing in multiple browsers\n  - Test in Chrome/Edge (Chromium), Firefox, Safari (if available)\n  - Verify theme switching works in all browsers\n  - Verify CSS renders correctly across browsers\n  - Purpose: Ensure cross-browser compatibility of refactored theme system\n  - _Leverage: Multiple browsers for testing_\n  - _Requirements: All requirements (cross-browser verification)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with expertise in cross-browser testing and compatibility | Task: Test theme system across multiple browsers following all requirements. Test in: (1) Chrome or Edge (Chromium), (2) Firefox, (3) Safari (if on macOS). For each browser, verify: theme toggle works, classes apply correctly (uk-dark/uk-light), localStorage works, CSS renders correctly, matchMedia system detection works, no console errors. Test at least Chrome/Edge and Firefox (Safari if available). | Restrictions: Must test in actual browsers not emulators, test theme functionality not just visual appearance, check console for JavaScript errors, verify localStorage and matchMedia API work | Leverage: Multiple browser installations, DevTools in each browser to inspect and test | Success: Theme switching works in all tested browsers, classes apply correctly, localStorage persists across sessions in all browsers, CSS renders correctly (no vendor-specific issues), matchMedia detection works, no console errors in any browser | Instructions: Mark in-progress. Test systematically in each available browser, document browser versions tested, note any browser-specific issues. Log with detailed artifacts (browsers tested with versions, features verified per browser, any compatibility issues found, console errors checked). Mark complete after testing minimum 2 browsers (ideally 3)._\n\n- [ ] 6.6. Final verification and documentation\n  - Files: All refactored files\n  - Perform final code review of all changes: variables, theme files, JavaScript, imports\n  - Verify all requirements met: semantic naming (uk-dark/uk-light), consistent variables (@light-/@dark-), centralized themes, clean switching\n  - Document any notable findings or edge cases discovered during testing\n  - Purpose: Final validation that refactoring is complete and correct\n  - _Leverage: All refactored files, requirements document_\n  - _Requirements: All requirements (final comprehensive verification)_\n  - _Prompt: Implement the task for spec theme-naming-refactor, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Senior Developer with expertise in code review and requirements validation | Task: Perform final comprehensive verification following all requirements. Review all changes: (1) _variables.less - verify all light variables use @light- prefix, dark use @dark- prefix, (2) _light-theme.less - verify comprehensive, uses body.uk-light, uses @light-* variables, (3) _dark-theme.less - verify uses body.uk-dark, uses @dark-* variables, (4) core.js - verify applies uk-dark/uk-light classes, mutual exclusion, FOUC prevention, (5) main.less - verify imports _light-theme, correct order. Validate against requirements: semantic naming ✓, consistent variables ✓, centralized themes ✓, clean switching ✓, backwards compatibility ✓. | Restrictions: Do not modify code (review only), check against all requirements systematically, verify no regressions introduced, ensure code quality maintained | Leverage: Requirements document, design document, all modified files, testing results from previous tasks | Success: All requirements validated and met, all changes reviewed and correct, no code quality issues, theme system works as designed, refactoring complete and production-ready | Instructions: Mark in-progress. Systematically review each file, check requirements checklist, verify testing results. Log with comprehensive artifacts (files reviewed, requirements validated, verification summary, production readiness assessment). Mark complete when all requirements confirmed met and refactoring fully validated._\n",
  "fileStats": {
    "size": 42867,
    "lines": 228,
    "lastModified": "2025-11-22T07:52:54.633Z"
  },
  "comments": []
}